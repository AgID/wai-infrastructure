# {{ ansible_managed }}
# GlusterFS resources
---
kind: Endpoints
apiVersion: v1
metadata:
  name: glusterfs-ep-{{ item }}
  namespace: {{ item }}
subsets:
{% for host in groups['gluster'] %}
  - addresses:
    - ip: {{ hostvars[host]['ansible_all_ipv4_addresses'][0] }}
    ports:
      - port: 1
{% endfor %}
---
kind: Service
apiVersion: v1
metadata:
  name: glusterfs-svc-{{ item }}
  namespace: {{ item }}
spec:
  ports:
    - port: 1
{% for n in range(0,5) %}

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: gluster-vol-{{ n }}-{{ item }}
  annotations:
    pv.beta.kubernetes.io/gid: "100"
spec:
  storageClassName: {{ item }}-storage-class
  capacity:
    storage: 5Gi
  accessModes:
    - ReadOnlyMany
  glusterfs:
    endpoints: glusterfs-ep-{{ item }}
    path: {{ item }}-vol-{{ n }}"
    readOnly: false
  persistentVolumeReclaimPolicy: Retain
  {% endfor %}